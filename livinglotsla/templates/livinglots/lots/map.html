{% load communityplanareas_tags councildistricts_tags feincms_tags i18n inplace_tags neighborhoodcouncils_tags static zoning_tags %}

<script id="popup-template" type="text/x-handlebars-template">
    {% verbatim %}
        <section class="popup">
            <header>
                <a target="_blank" href="{{detailUrl}}">
                    {{feature.properties.address_line1}}
                </a>
            </header>
            <div class="popup-streetview">
                <div>
                    {{#if feature.properties.centroid}}
                        <img src="http://maps.googleapis.com/maps/api/streetview?location={{feature.properties.centroid.[1]}},{{feature.properties.centroid.[0]}}&size=300x110&sensor=false&fov=45" />
                    {{else}}
                        <img src="http://maps.googleapis.com/maps/api/streetview?location={{feature.geometry.coordinates.[1]}},{{feature.geometry.coordinates.[0]}}&size=300x110&sensor=false&fov=45" />
                    {{/if}}
                </div>
            </div>
            <div class="popup-lot-details row">
                <div class="col-xs-2">
                    <a target="_blank" href="{{detailUrl}}" class="btn btn-learn-more">learn<br />more</a>
                    <a target="_blank" href="{{detailUrl}}#organize" class="btn btn-organize">organize</a>
                </div>
                <div class="col-xs-10">
                    {{#if feature.properties.organizers_count}}
                        <div class="popup-lot-details-organizers">
                            This lot has 
                            <span class="organizers-count">{{feature.properties.organizers_count}}</span>
                            {{#if feature.properties.organizers_count_plural}}
                                organizers.
                            {{else}}
                                organizer.
                            {{/if}}
                        </div>
                    {{/if}}
                    <div class="popup-lot-details-ain">
                        APN {{feature.properties.ain}}
                        {{#if feature.properties.zone_class}}
                            / Zone class: {{feature.properties.zone_class}}
                        {{/if}}
                    </div>
                    {{#if feature.properties.number_of_lots_plural}}
                        <div class="lot-count">
                            {{feature.properties.number_of_lots}}
                            lots
                        </div>
                    {{/if}}
                    <div class="size">{{feature.properties.size}} acres</div>
                    <div class="owner">
                        <span class="owner-type owner-type-{{feature.properties.owner.type}}">{{feature.properties.owner.type}}</span>
                        Owner: {{feature.properties.owner.name}}
                    </div>
                </div>
            </div>
        </section>
    {% endverbatim %}
</script>

<div id="map-scrollover">
    <div id="map-scrollover-row">
        <div id="map-scrollover-content">
            {% include "livinglots/lots/_scrollover.html" %}
        </div>
    </div>
</div>

<div id="map"
    data-l-zoom="10"
    data-l-center="[34.0248,-118.3255]"
    data-l-scroll-wheel-zoom="false"

    data-l-mapbox-id="{% inplace_setting PLACES_MAPBOX_ID %}"
    data-l-lot-centroids-url="{% url "lots:lot_geojson_centroid" %}"
    data-l-lot-polygons-url="{% url "lots:lot_geojson_polygon" %}"
    data-l-parcels-url="{% url "parcels:parcel_geojson" %}"
    data-l-add-lot-parent="#add-lot-parent"
>
    <div class="map-filters-wrapper">
        <div class="map-filters-inner-wrapper">
            <div id="map-sidebar-parent" class="map-overlay">
                <section id="map-filters-parent" class="map-filters">
                    <h2 class="map-filters-expander">{% trans "filter" %}</h2>
                    <section id="map-filters" class="map-filters-content">
                        <section class="map-filters">
                            <h3 class="map-filters-expander">{% trans "land access pathways" %}</h3>
                            <div class="map-filters-content">
                                <ul class="map-filters-type">
                                    <ul>
                                        <li class="map-filters-type-item map-filters-type-public on">
                                            <span class="map-filters-type-disc"></span>
                                            <input type="checkbox" name="public" class="filter filter-layer hidden" checked="true" />
                                            <span data-toggle="tooltip" data-placement="bottom" title="{% trans "Parcels that are owned by public agencies" %}">
                                                {% trans "publicly owned vacant" %}
                                            </span>
                                            (<span id="public-lots-count"></span>)
                                        </li>
                                        <ul>
                                            <li class="map-filters-type-item map-filters-type-public-sidelot on">
                                                <span class="map-filters-type-disc"></span>
                                                <input type="checkbox" name="public_sidelot" class="filter filter-layer hidden" checked="true" />
                                                <span data-toggle="tooltip" data-placement="bottom" title="{% trans "Parcels that are part of the city's side yard program" %}">
                                                    {% trans "side yard" %}
                                                </span>
                                                (<span id="public-sidelot-count"></span>)
                                            </li>
                                        </ul>
                                    </ul>
                                    <ul>
                                        <li class="map-filters-type-item map-filters-type-private on">
                                            <span class="map-filters-type-disc"></span>
                                            <input type="checkbox" name="private" class="filter filter-layer hidden" checked="true" />
                                            <span data-toggle="tooltip" data-placement="bottom" title="{% trans "Parcels that are owned by private entities" %}">
                                                {% trans "privately owned vacant" %}
                                            </span>
                                            (<span id="private-lots-count"></span>)
                                        </li>
                                    </ul>
                                    <ul>
                                        <li class="map-filters-type-item map-filters-type-in-use on">
                                            <span class="map-filters-type-disc"></span>
                                            <input type="checkbox" name="in_use" class="filter filter-layer hidden" />
                                            {% trans "green space" %}
                                            (<span id="in-use-count"></span>)
                                        </li>
                                        <li class="map-filters-type-item map-filters-type-organized on">
                                            <span class="map-filters-type-disc"></span>
                                            <input type="checkbox" name="organized" class="filter filter-layer hidden" />
                                            <span data-toggle="tooltip" data-placement="bottom" title="{% trans "Parcels that people are organizing to get access to" %}">
                                                {% trans "being organized" %}
                                            </span>
                                            (<span id="organized-count">0</span>)
                                        </li>
                                        <li class="map-filters-type-item map-filters-type-friendly-owner on">
                                            <span class="map-filters-type-disc"></span>
                                            <input type="checkbox" name="friendly_owner" class="filter filter-layer hidden" />
                                            <span data-toggle="tooltip" data-placement="bottom" title="{% trans "Parcels with friendly owners who might be more open to giving you access to them" %}">
                                                {% trans "friendly owner" %}
                                            </span>
                                            (<span id="friendly-owner-count">0</span>)
                                            <div>
                                                <a class="friendly-owner-share" href="#">
                                                    {% trans "I own land I'd like to share" %}
                                                </a>
                                        </li>
                                    </ul>
                                </ul>
                            </div>
                        </section>
                        <section class="map-filters">
                            <h3 class="map-filters-expander">{% trans "search" %}</h3>
                            <div class="map-filters-content">
                                <form class="map-filters-search-form" data-bounds="[-117.5359,33.5391,-118.8872,34.5733]" data-city="Los Angeles" data-state="CA" data-error-message="{% trans "Could not find your location. Try again?" %}" data-warning-selector=".map-filters-search.warning">
                                    <input id="map-filters-search" class="map-filters-search" type="search" placeholder="{% trans "address, intersection, zip" %}" />
                                    <div class="warning" style="display: none;"></div>
                                    <input id="map-filters-search-lat" type="hidden" />
                                    <input id="map-filters-search-lng" type="hidden" />
                                    <div class="map-filters-search-nearby">
                                        <input id="map-filters-search-nearby" name="map-filters-search-nearby" type="checkbox" />
                                        <label for="map-filters-search-nearby">{% trans "Show only lots within 1/2 mile" %}</label>
                                    </div>
                                </form>
                            </div>
                        </section>
                        <section class="map-filters">
                            <h3 class="map-filters-expander">{% trans "political boundaries" %}</h3>
                            <div class="map-filters-content">
                                <section class="map-filters map-filters-grouped">
                                    <h4 class="map-filters-expander">{% trans "council district" %}</h4>
                                    <div class="map-filters-content">
                                        <div class="map-filters-councildistricts">
                                            {% get_council_districts as councildistricts %}
                                            {% for councildistrict in councildistricts %}
                                            
                                                <a href="#" class="map-filters-councildistrict pull-left" data-label="{{ councildistrict.label }}" data-type="councildistricts">
                                                    {{ councildistrict.label }} 
                                                </a>
                                            {% endfor %}
                                            <div class="clearfix"></div>
                                        </div>
                                    </div>
                                </section>
                                <section class="map-filters map-filters-grouped">
                                    <h4 class="map-filters-expander">{% trans "neighborhood council area" %}</h4>
                                    <div class="map-filters-content">
                                        <select class="map-filters-neighborhoodcouncils" data-type="neighborhoodcouncils">
                                            <option value="">Pick one</option>
                                            {% get_neighborhood_councils as neighborhoodcouncils %}
                                            {% for neighborhoodcouncil in neighborhoodcouncils %}
                                                <option value="{{ neighborhoodcouncil.label }}">
                                                    {{ neighborhoodcouncil.label }} 
                                                </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </section>
                                <section class="map-filters map-filters-grouped">
                                    <h4 class="map-filters-expander">{% trans "community plan area" %}</h4>
                                    <div class="map-filters-content">
                                        <select class="map-filters-communityplanareas" data-type="communityplanareas">
                                            <option value="">Pick one</option>
                                            {% get_community_plan_areas as communityplanareas %}
                                            {% for communityplanarea in communityplanareas %}
                                                <option value="{{ communityplanarea.label }}">
                                                    {{ communityplanarea.label }} 
                                                </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </section>
                                <section class="map-filters map-filters-grouped">
                                    <h4 class="map-filters-expander">{% trans "zoning code" %}</h4>
                                    <div class="map-filters-content">
                                        <select class="filter map-filters-zoneclasses">
                                            <option value="">Pick one</option>
                                            {% get_zoning_classes as zone_classes %}
                                            {% for group, classes in zone_classes.items %}
                                                <optgroup label="{{ group }}">
                                                    {% for class in classes %}
                                                        <option>{{ class }}</option>
                                                    {% endfor %}
                                                </optgroup>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </section>
                            </div>
                        </section>
                        <section class="map-filters">
                            <h3 class="map-filters-expander">{% trans "size" %}</h3>
                            <div class="map-filters-content">
                                <div class="filter filter-size"></div>
                                <div class="filter-size-labels">
                                    <span class="filter-size-label-min"></span>
                                    <span class="filter-size-label-max"></span>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                        </section>
                    </section>
                </section>


                {% if "lot.add_lot" in perms %}
                    <section id="map-admin-parent" class="map-filters">
                        <h2 class="map-filters-expander">{% trans "admin" %}</h2>
                        <section class="map-filters-content">
                            <a id="admin-button-add-lot" class="btn btn-admin btn-block">
                                {% trans "add lot" %}
                            </a>
                            <div id="add-lot-parent"></div>
                        </section>
                    </section>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="map-download-wrapper">
        <div class="map-download-inner-wrapper">
            <div id="map-download" class="map-overlay">
                <div>
                    <a class="details-link" href="#">{% trans "link to this view" %}</a>
                </div>

                <section class="details-buttons hidden-print">
                    {% trans "download map as" %}
                    <a href="#" class="export export-csv" data-baseurl="{% url "lots:csv" %}?">
                        {% trans "csv" %}
                    </a> /
                    <a href="#" class="export export-geojson" data-baseurl="{% url "lots:geojson" %}?download=yes&">
                        {% trans "GeoJSON" %}
                    </a> /
                    <a href="#" class="export export-kml" data-baseurl="{% url "lots:kml" %}?">
                        {% trans "KML" %}
                    </a>
                </section>
            </div>
        </div>
    </div>
</div>

{% comment %}
<div class="overlaymenu overlaymenu-details">
    {% include "livinglots/lots/details.html" %}
</div>

<div class="overlaymenu overlaymenu-news">
    <div class="overlaymenu-tip-container">
        <div class="overlaymenu-tip"></div>
    </div>
    <div class="overlaymenu-menu-content">
        <div class="activity-stream-section map-sidebar-section">
            <h2>{% trans "Recent Activity" %}</h2>
            <div class="activity-stream"></div>
        </div>
    </div>
</div>
{% endcomment %}
